---
# http://serverfault.com/questions/587727/how-to-unify-package-installation-tasks-in-ansible

- hosts: all
  remote_user: vagrant
  vars_files:
    - [ "vars/{{ ansible_distribution }}.yml", "vars/default.yml" ]
  vars:
    # Username
    user: vagrant
    rootkits:
        beurk:
            url: https://github.com/unix-thrust/beurk.git
            dest: ~/project/beurk
            version: dev
        azazel:
            url: https://github.com/chokepoint/azazel.git
            dest: ~/project/azazel
            version: master
    antirootkits:
        ossec:
            url: https://github.com/ossec/ossec-hids.git
            dest: ~/project/ossec
            version: stable
    install_selinux: false
    install_apparmor: false

  tasks:
    ###################
    # Use good pkg_mgr
    ###################
    - include: tasks/aptget.yml
      when: ansible_pkg_mgr == 'apt'
    - include: tasks/yum.yml
      when: ansible_pkg_mgr == 'yum'
    - include: tasks/pkg.yml
      when: ansible_pkg_mgr == 'pkgng'

    ###################
    # Install peda
    ###################
    - name: Install peda
      git: repo=https://github.com/longld/peda.git dest=/home/vagrant/.peda
    - name: Add .gdbinit file
      copy: content=source ~/.peda/peda.py
            dest=/home/vagrant/.gdbinit

    ###################
    # Install rootkits
    ###################
    - name: Clone rootkits
      # debug: msg="Clone {{ item.key }} in {{ item.value.dest }}."
      git: repo={{ item.value.url }}
           dest={{ item.value.dest }}
           version={{ item.value.version }}
      with_dict: rootkits

    ###################
    # Install antirootkits
    ###################
    - name: Clone antirootkits
      # debug: msg="Clone {{ item.key }} in {{ item.value.dest }}."
      git: repo={{ item.value.url }}
           dest={{ item.value.dest }}
           version={{ item.value.version }}
      with_dict: antirootkits
